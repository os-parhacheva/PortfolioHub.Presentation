@page "/profile"
@using System.ComponentModel.DataAnnotations


<PageTitle>Профиль пользователя</PageTitle>

@if (userDTO != null) 
{ 
    <div class="user-profile-container">
        <div class="profile-header">
            <h2>Профиль пользователя</h2>
            <div class="avatar-placeholder">
                @GetInitials()
            </div>
        </div>

        <div class="profile-sections">
            <!-- Личная информация -->
            <div class="profile-section">
                <h3 class="section-title">
                    <i class="fas fa-user section-icon"></i>
                    Личная информация
                </h3>

                <div class="info-grid">
                    <div class="info-item">
                        <label class="info-label">ФИО:</label>
                        <div class="info-value">
                            @(userDTO.LastName + " " + userDTO.FirstName + " " + userDTO.MiddleName)
                        </div>
                    </div>

                    <div class="info-item">
                        <label class="info-label">Дата рождения:</label>
                        <div class="info-value">
                            @userDTO.BirthDate.ToString("dd.MM.yyyy")
                            <span class="age-badge">(@CalculateAge() лет)</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Контактная информация -->
            <div class="profile-section">
                <h3 class="section-title">
                    <i class="fas fa-envelope section-icon"></i>
                    Контактная информация
                </h3>

                <div class="info-grid">
                    <div class="info-item">
                        <label class="info-label">Email:</label>
                        <div class="info-value">
                            <!-- Ссылка mailto для открытия почтового клиента -->
                            <a href="mailto:@userDTO.Email" class="contact-link">
                                <i class="fas fa-envelope contact-icon"></i>
                                @userDTO.Email
                            </a>
                        </div>
                    </div>

                    <div class="info-item">
                        <label class="info-label">Телефон:</label>
                        <div class="info-value">
                            <!-- Ссылка tel для совершения звонка (на мобильных устройствах) -->
                            <a href="tel:@userDTO.Phone" class="contact-link">
                                <i class="fas fa-phone contact-icon"></i>
                                @FormatPhoneNumber()
                            </a>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Образование -->
            <div class="profile-section">
                <h3 class="section-title">
                    <i class="fas fa-graduation-cap section-icon"></i>
                    Образование
                </h3>

                <div class="info-grid">
                    <div class="info-item">
                        <label class="info-label">Университет:</label>
                        <div class="info-value">@userDTO.University</div>
                    </div>

                    <div class="info-item">
                        <label class="info-label">Факультет:</label>
                        <div class="info-value">@userDTO.Faculty</div>
                    </div>

                    <div class="info-item">
                        <label class="info-label">Специальность:</label>
                        <div class="info-value">@userDTO.Speciality</div>
                    </div>

                    <div class="info-item">
                        <label class="info-label">Курс:</label>
                        <div class="info-value">
                            <!-- Стилизованный бейдж для отображения курса -->
                            <span class="grade-badge">@GetGradeDisplay()</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
     </div>
}else
{
    <p>Загрузка данных...</p>
}


@code {
    private Guid userId = Guid.Parse("49aa4dea-b974-44fd-3382-08de5c4e2a2f"); 
    private UserDTO userDTO;

    protected async override Task OnParametersSetAsync()
    {
        userDTO = await Http.GetFromJsonAsync<UserDTO>($"https://localhost:7264/api/User/{userId}");
    }

    // Свойства модели пользователя
    // public Guid Id { get; set; }
    // public string FirstName { get; set; } = "";
    // public string LastName { get; set; } = "";
    // public string MiddleName { get; set; } = "";
    // public DateTime BirthDate { get; set; }
    // public string Email { get; set; } = "";
    // public string Phone { get; set; } = "";
    // public string University { get; set; } = "";
    // public string Faculty { get; set; } = "";
    // public string Speciality { get; set; } = "";
    // public int Graid { get; set; }

    // protected override void OnInitialized()
    // {
    //     Пример заполнения данными (в реальном проекте данные будут приходить из API)
    //     Id = Guid.NewGuid();
    //     FirstName = "Иван";
    //     LastName = "Иванов";
    //     MiddleName = "Иванович";
    //     BirthDate = new DateTime(2000, 5, 15);
    //     Email = "ivanov@example.com";
    //     Phone = "+79001234567";
    //     University = "Национальный исследовательский университет";
    //     Faculty = "Информационных технологий";
    //     Speciality = "Программная инженерия";
    //     Graid = 3;
    // }

    private string GetInitials()
    {
        var first = userDTO.FirstName.Length > 0 ? userDTO.FirstName[0].ToString() : "";
        var last = userDTO.LastName.Length > 0 ? userDTO.LastName[0].ToString() : "";
        return $"{last}{first}".ToUpper();
    }

    private int CalculateAge()
    {
        var today = DateTime.Today;
        var age = today.Year - userDTO.BirthDate.Year;
        if (userDTO.BirthDate.Date > today.AddYears(-age)) age--;
        return age;
    }

    private string FormatPhoneNumber()
    {
        if (string.IsNullOrEmpty(userDTO.Phone)) return "";

        if (userDTO.Phone.StartsWith("+7") && userDTO.Phone.Length == 12)
        {
            return $"+7 ({userDTO.Phone.Substring(2, 3)}) {userDTO.Phone.Substring(5, 3)}-{userDTO.Phone.Substring(8, 2)}-{userDTO.Phone.Substring(10, 2)}";
        }

        return userDTO.Phone;
    }

    private string GetGradeDisplay()
    {
        return $"{userDTO.Graid} курс";
    }
}
